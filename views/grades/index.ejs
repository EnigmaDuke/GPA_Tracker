<%- include("../partials/header.ejs") %> 


<main>
  <div class="container_nav">
    <ul>
      <li><a href="/semesters/<%=semester._id%>/courses"> Courses </a></li>
    </ul>
    <ul>
      <li><a id="edit" href="#">Edit</a></li>
      <li><a class="hidden" href="/semesters/<%=semester._id%>/courses/<%=course._id%>/grades">Done </a></li>
    </ul>
  </div>

  <section>
    <div class="hidden">
      <a href="/semesters/<%=semester._id%>/courses/<%=course._id%>/grades/new">
        <i class="fas fa-plus-circle"></i>New Grade
      </a>
    </div>
  </section>

  </div>

  <!-- Calculate Current Grade -->
  <% let totalGrade   = 0   %>
  <% let grade        = 0   %>
  <% let divide       = 100 %>
  <% let noGrade      = []  %>
  <% let currentGrade = 100 %>

  <div class="current_grade">
    <% for(let i = 0; i < course.grades.length; i++){ %>

      <% if(typeof course.grades[i].grade === 'undefined'){ %>
          <% console.log("if statement running ")%>
          <% course.grades[i].grade == 0 %>

          <% console.log("=== course.grades[i].grade ===  : IF STATEMENT") %>
          <% console.log(course.grades[i].grade) %>
          <% noGrade.push(course.grades[i].weight)  %>
          <% continue;%>

      <% } else { %>
        <% totalGrade += ((course.grades[i].grade) * (course.grades[i].weight)) %>
        <% console.log("=== course.grades[i].grade === ") %>
        <% console.log(course.grades[i].grade) %>
      <% } %>

    <% } %>
  <% console.log("====== NO GRADE ======") %>
  <% console.log(noGrade) %>%>  

  <% let sumDivision = noGrade.reduce((a,b)=>{ %>
  <%    return a + b; %>
  <% }, 0)  %>
  <% console.log("SUMDIVISION") %>
  <% console.log(sumDivision) %>

  <% sumDivision = ((100 - sumDivision) / 100) %>
  <% console.log("SUMDIVISION") %>
  <% console.log(sumDivision) %>

  <% totalGrade = ((totalGrade / divide) / sumDivision) %>
  <% console.log("TOTAL GRADE") %>
  <% console.log(totalGrade) %>

    <p>Current Grade: <%= totalGrade %></p>
  </div>

  <div class="target_grade">
    <p>Target Grade</p>
  </div>

  <!-- ====== CONTAINER ====== -->
  <div id="courses_container">
    <% course.grades.forEach((grade)=>{ %>

      <div class="card">
        <div class="hide hidden">
          <form action="" method="POST">
            <button>
              <i class="fas fa-minus-circle"></i>
            </button>
          </form>
        </div>
        <div>
          <p class="course_name"> <i class="fas fa-school"></i> <%= grade.assignmentName %></p>
        </div>
        <div>
          <p><%= grade.grade %> %</p>
        </div>


      <!-- === UPDATE === Edit a Grade -->
      <div class="hide hidden" id="courses_container">
        <form class="hide hidden" action="/semesters/<%=semester._id%>/courses/<%=course._id%>/grades/<%=grade._id%>?_method=PUT" method="POST">
          <input type="text"  name="grade[assignmentName]" value="<%= grade.assignmentName%>">
          <!-- change to grade.weight -->
          <input id="number" type="number"  name="grade[grade]" value="<%= grade.grade%>">

          <input type="submit">
        </form>
      </div>


    <% }) %>
  </div>
</main>

<script>
  let edit = document.querySelector("#edit");
  let hidden = document.querySelectorAll(".hidden");
  let number = document.querySelector("#number");

  edit.addEventListener("click", ()=>{
    hidden.forEach((element)=>{
      element.classList.remove("hidden");

    })
    // edit.innerHTML = "DONE";
    edit.classList.add("hidden");
  }, ()=>{
    alert("done");
  });



</script>



<%- include("../partials/footer.ejs") %> 
